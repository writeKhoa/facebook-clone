Đây là một ví dụ về cập nhật một phần tử trong mảng và xóa một phần tử trong
mảng bằng sử dụng findOneAndUpdate với async/await trong Node.js: php Copy code
async function updateAndRemoveArrayItem(documentId, oldValue, newValue,
valueToRemove) { try { const updatedDocument = await Model.findOneAndUpdate( {
_id: documentId }, { $set: { "array.$[element].field": newValue }, $pull: {
array: { field: valueToRemove } } }, { arrayFilters: [{ "element.field":
oldValue }], new: true } ).exec(); console.log(updatedDocument); } catch (error)
{ console.error(error); } } Trong trường hợp này, chúng ta đang sử dụng
findOneAndUpdate để tìm và cập nhật một tài liệu duy nhất theo điều kiện { _id:
documentId }. Sử dụng operator $set để cập nhật một phần tử trong mảng và
operator $pull để xóa một phần tử trong mảng. Chúng ta cũng đang sử dụng
arrayFilters để chỉ định phần tử trong mảng cần cập nhật và new để chỉ rằng
chúng ta muốn trả về tài liệu cập nhật sau khi thực hiện hành động. Về exec()
trong Mongoose, nó là một phương thức của một đối tượng Query trong Mongoose, nó
thực hiện truy vấn và trả về một Promise chứa kết quả truy vấn. Chúng ta sử dụng
exec() để thực hiện

<!-- update flexible one property in model  -->

<code>
  const mongoose = require('mongoose'); const Account =
  require('./models/Account'); mongoose.connect('mongodb://localhost/mydb', {
  useNewUrlParser: true, useUnifiedTopology: true }); const id =
  '5e9f2e99efd7c914f4a6b4e6'; const update = { name: 'New Name' };
  Account.findByIdAndUpdate(id, update, { new: true }, (err, account) => { if
  (err) { console.error(err); } else { console.log(account); } });
</code>
